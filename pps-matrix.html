<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å vs –û–±—ä–µ–º - NBA Charts</title>
    <link rel="stylesheet" href="shared.css">
</head>
<body>
    <div class="container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="site-navigation">
            <div class="nav-breadcrumb">
                <a href="index.html">NBA Charts</a> > –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å vs –û–±—ä–µ–º
            </div>
            <div class="chart-navigation">
                <a href="pps-matrix.html" class="nav-button active">üìä –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å vs –û–±—ä–µ–º</a>
                <a href="evolution.html" class="nav-button">üìà –≠–≤–æ–ª—é—Ü–∏—è –ù–ë–ê</a>
            </div>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="header">
            <h1 class="main-title">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å vs –û–±—ä–µ–º</h1>
            <h2 class="subtitle">–ù–ë–ê —Å–µ–∑–æ–Ω 2024-25: –û—á–∫–∏ –∑–∞ –±—Ä–æ—Å–æ–∫</h2>
            <p class="description">
                –†–∞–∑–º–µ—Ä –∫—Ä—É–≥–∞ = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–±—Ä–∞–Ω–Ω—ã—Ö –æ—á–∫–æ–≤ ‚Ä¢ –ú–∏–Ω–∏–º—É–º 100 –±—Ä–æ—Å–∫–æ–≤ –∑–∞ —Å–µ–∑–æ–Ω
            </p>
        </div>

        <!-- –ü–æ–∏—Å–∫ -->
        <div class="search-container">
            <input 
                type="text" 
                id="search-input" 
                class="search-input" 
                placeholder="–ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: Devin –∏–ª–∏ Booker)"
            >
            <button id="clear-search" class="clear-search" style="display: none;">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫ -->
        <div class="chart-container">
            <div id="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ù–ë–ê...</div>
            <svg id="chart" width="1000" height="700" style="display: none;"></svg>
        </div>

        <!-- –õ–µ–≥–µ–Ω–¥–∞ -->
        <div class="legend">
            <h3>–¢–∏–ø—ã –±—Ä–æ—Å–∫–æ–≤</h3>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #FF6B35;"></div>
                    <span class="legend-text">–î–∞–Ω–∫–∏</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #5DADE2;"></div>
                    <span class="legend-text">–¢—Ä–µ—à–∫–∏ —Å –¥—É–≥–∏</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #27AE60;"></div>
                    <span class="legend-text">–£–≥–ª–æ–≤—ã–µ —Ç—Ä–µ—à–∫–∏</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #E74C3C;"></div>
                    <span class="legend-text">–ú–∏–¥—Ä–µ–π–Ω–¥–∂</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Hover tooltip -->
    <div id="hover-info" class="hover-info"></div>

    <script src="shared.js"></script>
    <script>
        // –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let chartData = [];
        let allCircles, allTexts;
        let currentSearch = '';

        // –ü–û–õ–ù–û–°–¢–¨–Æ –ü–ï–†–ï–ü–ò–°–ê–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º —Å–∫—Ä—ã—Ç–∏–µ–º —Ç–µ–∫—Å—Ç–∞
        function searchPlayers(searchTerm) {
            currentSearch = searchTerm.toLowerCase().trim();
            
            if (!currentSearch) {
                // –°–±—Ä–æ—Å –ø–æ–∏—Å–∫–∞ - –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                allCircles.each(function(d) {
                    const circle = d3.select(this);
                    const isKey = NBA_Utils.isKeyPlayer(d.player_name, d.shot_type);
                    
                    circle
                        .classed('circle-highlighted circle-dimmed', false)
                        .classed('circle-key-player', isKey)
                        .classed('circle-normal', !isKey);
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Ç–µ–∫—Å—Ç—ã –∫–ª—é—á–µ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
                allTexts
                    .attr('opacity', 1)
                    .style('display', 'block')
                    .classed('text-dimmed text-highlighted text-hidden', false)
                    .classed('text-key-player', true);

                document.getElementById('clear-search').style.display = 'none';
                return;
            }

            document.getElementById('clear-search').style.display = 'inline-block';

            // –ù–∞—Ö–æ–¥–∏–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
            const matches = chartData.filter(d => 
                d.player_name.toLowerCase().includes(currentSearch)
            );

            if (matches.length === 0) {
                // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π, –∑–∞—Ç–µ–º–Ω—è–µ–º –≤—Å–µ –∏ –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –°–ö–†–´–í–ê–ï–ú –≤—Å–µ —Ç–µ–∫—Å—Ç—ã
                allCircles.classed('circle-dimmed', true)
                          .classed('circle-highlighted circle-key-player circle-normal', false);
                
                // –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –°–ö–†–´–í–ê–ï–ú –í–°–ï –¢–ï–ö–°–¢–´ –í–°–ï–ú–ò –°–ü–û–°–û–ë–ê–ú–ò
                allTexts
                    .attr('opacity', 0)
                    .style('display', 'none')
                    .classed('text-hidden', true)
                    .classed('text-key-player text-highlighted', false);
                return;
            }

            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ, –∑–∞—Ç–µ–º–Ω—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ
            allCircles.each(function(d) {
                const circle = d3.select(this);
                const isMatch = matches.some(m => 
                    m.player_name === d.player_name && m.shot_type === d.shot_type
                );
                
                circle
                    .classed('circle-highlighted', isMatch)
                    .classed('circle-dimmed', !isMatch)
                    .classed('circle-key-player circle-normal', false);
            });

            // –£–ü–†–ê–í–õ–Ø–ï–ú –¢–ï–ö–°–¢–ê–ú–ò –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
            allTexts.each(function(d) {
                const text = d3.select(this);
                const isMatch = matches.some(m => 
                    m.player_name === d.player_name && m.shot_type === d.shot_type
                );
                
                if (isMatch) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ
                    text
                        .attr('opacity', 1)
                        .style('display', 'block')
                        .classed('text-highlighted', true)
                        .classed('text-dimmed text-hidden text-key-player', false);
                } else {
                    // –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –°–ö–†–´–í–ê–ï–ú –Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ
                    text
                        .attr('opacity', 0)
                        .style('display', 'none')
                        .classed('text-hidden', true)
                        .classed('text-highlighted text-key-player', false);
                }
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ PPS Matrix
        async function createChart() {
            chartData = await NBA_Utils.loadPlayersData();
            
            if (chartData.length === 0) {
                document.getElementById('loading').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö';
                return;
            }

            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
            document.getElementById('loading').style.display = 'none';
            document.getElementById('chart').style.display = 'block';

            const dimensions = NBA_Utils.getChartDimensions();
            const svg = d3.select('#chart');
            
            svg.attr('width', dimensions.width).attr('height', dimensions.height);
            
            const width = dimensions.width - dimensions.margin.left - dimensions.margin.right;
            const height = dimensions.height - dimensions.margin.top - dimensions.margin.bottom;

            // Scales
            const xScale = d3.scaleLinear()
                .domain(d3.extent(chartData, d => d.fga))
                .range([0, width])
                .nice();

            const yScale = d3.scaleLinear()
                .domain(d3.extent(chartData, d => d.pps))
                .range([height, 0])
                .nice();

            const sizeScale = d3.scaleSqrt()
                .domain(d3.extent(chartData, d => d.totalPoints))
                .range([Math.min(width, height) * 0.008, Math.min(width, height) * 0.04]);

            const g = svg.append('g')
                .attr('transform', `translate(${dimensions.margin.left},${dimensions.margin.top})`);

            // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É
            NBA_Utils.createGrid(g, xScale, yScale, width, height);

            // –¢–æ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö
            allCircles = g.selectAll('.data-point')
                .data(chartData)
                .enter()
                .append('circle')
                .attr('class', d => `data-point ${NBA_Utils.isKeyPlayer(d.player_name, d.shot_type) ? 'circle-key-player' : 'circle-normal'}`)
                .attr('cx', d => xScale(d.fga))
                .attr('cy', d => yScale(d.pps))
                .attr('r', d => sizeScale(d.totalPoints))
                .attr('fill', d => NBA_COLORS[d.shot_type])
                .style('cursor', 'pointer')
                .on('mouseover', NBA_Hover.handlePPSMouseOver)
                .on('mouseout', NBA_Hover.handleMouseOut);

            // PPS –≤–Ω—É—Ç—Ä–∏ –∫—Ä—É–≥–æ–≤ –∏ –∏–º–µ–Ω–∞ –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
            const keyPlayerTexts = [];
            chartData.filter(d => NBA_Utils.isKeyPlayer(d.player_name, d.shot_type)).forEach(player => {
                const x = xScale(player.fga);
                const y = yScale(player.pps);
                const r = sizeScale(player.totalPoints);

                // PPS –≤–Ω—É—Ç—Ä–∏ –∫—Ä—É–≥–∞
                const ppsText = g.append('text')
                    .attr('class', 'pps-text text-key-player')
                    .attr('x', x)
                    .attr('y', y)
                    .datum(player)
                    .text(player.pps.toFixed(2));

                // –ò–º—è –∏–≥—Ä–æ–∫–∞ —Å–Ω–∞—Ä—É–∂–∏
                const nameText = g.append('text')
                    .attr('class', 'player-name-text text-key-player')
                    .attr('x', x)
                    .attr('y', y - r - 8)
                    .datum(player)
                    .text(player.player_name);

                keyPlayerTexts.push(ppsText, nameText);
            });

            allTexts = d3.selectAll(keyPlayerTexts);

            // –°–æ–∑–¥–∞–µ–º –æ—Å–∏
            NBA_Utils.createAxes(g, xScale, yScale, width, height, dimensions.margin, 
                               '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ—Å–∫–æ–≤', '–û—á–∫–∏ –∑–∞ –±—Ä–æ—Å–æ–∫');

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∏—Å–∫–∞
            const searchInput = document.getElementById('search-input');
            const clearButton = document.getElementById('clear-search');

            searchInput.addEventListener('input', (e) => {
                searchPlayers(e.target.value);
            });

            clearButton.addEventListener('click', () => {
                searchInput.value = '';
                searchPlayers('');
            });
        }

        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', () => {
            d3.select('#chart').selectAll('*').remove();
            createChart();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadD3(createChart);
    </script>
</body>
</html>